{
    "id": 1524,
    "guid": "be5348e070445a4573f51d5b60b0a7fd",
    "sort_order": "13",
    "content": "The RagSequenceForGeneration forward method, overrides the __call__ special method.\nAlthough the recipe for forward pass needs to be defined within this function, one should\ncall the Module instance afterwards instead of this since the former takes care of running\nthe pre and post processing steps while the latter silently ignores them.\nExample:\n>>> from transformers import AutoTokenizer, RagRetriever, RagSequenceForGene\n>>> import torch\n>>> tokenizer = AutoTokenizer.from_pretrained(\"facebook\/rag-sequence-nq\")\n>>> retriever = RagRetriever.from_pretrained(\n...     \"facebook\/rag-sequence-nq\", index_name=\"exact\", use_dummy_dataset=Tr\n... )\n>>> # initialize with RagRetriever to do everything in one forward call\n>>> model = RagSequenceForGeneration.from_pretrained(\"facebook\/rag-token-nq\n>>> inputs = tokenizer(\"How many people live in Paris?\", return_tensors=\"pt\n>>> targets = tokenizer(text_target=\"In Paris, there are 10 million people.\n>>> input_ids = inputs[\"input_ids\"]\n>>> labels = targets[\"input_ids\"]\n>>> outputs = model(input_ids=input_ids, labels=labels)\n>>> # or use retriever separately\n>>> model = RagSequenceForGeneration.from_pretrained(\"facebook\/rag-sequence\n>>> # 1. Encode\n>>> question_hidden_states = model.question_encoder(input_ids)[0]\n>>> # 2. Retrieve\n>>> docs_dict = retriever(input_ids.numpy(), question_hidden_states.detach()\n>>> doc_scores = torch.bmm(\n...     question_hidden_states.unsqueeze(1), docs_dict[\"retrieved_doc_embeds\n... ).squeeze(1)\n>>> # 3. Forward to generator\n>>> outputs = model(\n...     context_input_ids=docs_dict[\"context_input_ids\"],\n...     context_attention_mask=docs_dict[\"context_attention_mask\"],\n...     doc_scores=doc_scores,\n...     decoder_input_ids=labels,\n... ) ",
    "original_content": "The RagSequenceForGeneration forward method, overrides the __call__ special method.\nAlthough the recipe for forward pass needs to be defined within this function, one should\ncall the Module instance afterwards instead of this since the former takes care of running\nthe pre and post processing steps while the latter silently ignores them.\nExample:\n>>> from transformers import AutoTokenizer, RagRetriever, RagSequenceForGene\n>>> import torch\n>>> tokenizer = AutoTokenizer.from_pretrained(\"facebook\/rag-sequence-nq\")\n>>> retriever = RagRetriever.from_pretrained(\n...     \"facebook\/rag-sequence-nq\", index_name=\"exact\", use_dummy_dataset=Tr\n... )\n>>> # initialize with RagRetriever to do everything in one forward call\n>>> model = RagSequenceForGeneration.from_pretrained(\"facebook\/rag-token-nq\n>>> inputs = tokenizer(\"How many people live in Paris?\", return_tensors=\"pt\n>>> targets = tokenizer(text_target=\"In Paris, there are 10 million people.\n>>> input_ids = inputs[\"input_ids\"]\n>>> labels = targets[\"input_ids\"]\n>>> outputs = model(input_ids=input_ids, labels=labels)\n>>> # or use retriever separately\n>>> model = RagSequenceForGeneration.from_pretrained(\"facebook\/rag-sequence\n>>> # 1. Encode\n>>> question_hidden_states = model.question_encoder(input_ids)[0]\n>>> # 2. Retrieve\n>>> docs_dict = retriever(input_ids.numpy(), question_hidden_states.detach()\n>>> doc_scores = torch.bmm(\n...     question_hidden_states.unsqueeze(1), docs_dict[\"retrieved_doc_embeds\n... ).squeeze(1)\n>>> # 3. Forward to generator\n>>> outputs = model(\n...     context_input_ids=docs_dict[\"context_input_ids\"],\n...     context_attention_mask=docs_dict[\"context_attention_mask\"],\n...     doc_scores=doc_scores,\n...     decoder_input_ids=labels,\n... ) ",
    "created_at": "2024-05-07T02:41:37.000000Z",
    "updated_at": "2024-05-07T02:43:23.000000Z",
    "summary": "Here is the cleaned-up response:\n\nRagSequenceForGeneration overrides the __call__ special method and uses a Module instance instead of calling __call__ to ensure pre and post processing steps are executed.",
    "embedding_1536": null,
    "embedding_2048": null,
    "embedding_3072": null,
    "embedding_4096": null,
    "embedding_1024": "[0.2833156,-0.1740412,-0.26983476,0.66993374,-0.4616239,0.10124546,-0.24371284,0.24706057,0.029491935,0.15274319,-0.48885822,-0.17857568,0.16216204,0.33048862,-0.21488298,-0.39275646,-0.314557,0.2268425,-1.0446563,-0.35647646,0.17696221,0.9421616,-0.88624036,-0.5089711,-0.19124128,0.2942648,0.50808054,-0.07200357,0.2927437,0.37328237,0.13684963,-0.2291424,-0.007479202,-0.83415264,-0.1168968,-0.71631825,0.81548434,-0.42128086,0.45833594,-0.42115644,0.5835815,-0.3687164,0.15155587,-0.12554044,-0.33456713,-0.47228822,0.44748598,-0.27966166,0.16653402,0.12294407,0.57433116,0.0132464245,-0.20869079,0.3088195,0.012614574,-0.05094661,-0.43692213,-0.11562349,-0.63694364,0.53430927,-0.103296444,0.16828755,0.73733306,-0.68894106,-0.12074305,0.483908,0.14751747,-0.04445871,-0.33962402,0.18491518,-0.22302431,0.047863793,-0.32119682,-0.070567586,-0.06010481,-0.40484357,-0.0045923814,-0.49269155,-0.07760064,0.36360958,-0.0689267,0.46090057,-0.2152997,0.081285894,0.16352622,0.005542591,0.22551142,0.7614281,-0.66539603,0.16278304,-0.046360683,0.27090728,-0.8511082,0.077465266,0.36589646,0.37301168,0.09013626,-0.2007373,0.5972616,-0.2322918,0.38121828,0.974118,-0.14554898,0.55848527,0.14919797,0.20815289,-0.35354206,-0.13382334,0.30495444,-0.4042956,0.5720511,0.06633643,-0.3945133,-0.15707743,-0.62625355,0.5831096,-0.19343613,0.35354576,-0.29469976,0.3976709,-1.133416,-0.11825642,0.4110756,-0.042910703,0.86396223,-0.23317492,0.10177118,0.40758824,-0.8236189,-0.26242542,0.31349856,-0.5778723,-0.13468674,0.29430202,-0.5693212,-0.127091,-0.0759794,0.060588438,0.56977534,-0.35972127,-0.11981398,-0.45878637,-0.08750656,0.8998911,0.24642345,0.4411615,-0.3717215,0.07048446,-0.33899632,0.08054909,-0.14769652,-0.67063713,-0.18483625,-0.07115548,-0.35712484,0.14887442,0.04283203,0.22259222,-0.29911548,-0.034356635,-0.12600009,0.4833173,-0.12606692,0.48789752,-0.07388295,0.5908554,-1.1715328,-0.12511174,-0.014261726,0.35853958,0.34920222,0.31321934,0.3507814,0.90391403,0.609725,0.7339669,0.06185963,-0.32001898,0.27676013,0.14420708,-0.02448674,0.08621976,0.54102373,0.6150007,-0.102360904,0.33401567,-0.6553852,0.10442408,-0.15030758,-0.14852083,-0.5057539,0.5264399,-0.4602133,0.3698581,0.54777527,0.4105703,-1.009187,-0.35744286,0.022489525,-0.76601213,-0.35840955,0.4897979,-0.353141,0.04612805,-0.10758717,0.13555932,0.23617187,0.447209,-0.31485915,0.48489463,0.52038735,0.23771949,-0.43744126,0.36983117,0.28725398,-0.0082369,-0.6764064,0.7059803,-0.47630364,0.07672004,0.52554995,0.279767,-0.0009375103,0.6504868,0.39390975,-0.16451599,-0.110561036,0.470883,-0.29652756,-0.25215748,-0.0100110695,0.61739135,-0.25309286,0.8311358,0.2358598,-0.4081995,0.05290661,-0.043250427,0.47942075,0.019202612,0.51307225,0.8509861,0.8779598,0.35744825,0.5712311,0.51500475,-0.34684432,-0.3357077,-0.2687346,0.34803364,0.21597794,0.49522927,0.40065607,0.0712713,-0.5754018,-0.21182087,0.6290149,0.47940594,-0.034496456,-1.2090805,-0.38537318,-0.057456873,-0.22430693,-0.57699096,-0.014283126,0.78217226,-0.7865083,0.29116884,-0.12001485,-0.43667638,-0.76406586,-0.692715,-1.0344374,-0.527511,-0.15647778,-0.81526864,0.5824022,-0.3212852,0.65197945,0.28780788,-0.57080466,0.2410753,-0.26633185,0.46509147,-0.088439755,0.16451024,-0.8825359,-0.105169356,0.13850698,1.0310955,-0.31580788,-0.14126043,-0.09429363,-0.4129411,0.12027165,0.11061101,0.49274778,0.115008876,-0.1173881,0.24925518,0.1047119,-0.015120997,0.01573651,-0.030871045,0.03884103,0.6242862,-0.10546765,0.22727534,0.305375,0.34778318,-0.881111,0.42343828,-0.49406216,0.30900428,-0.48114267,0.75914514,0.5592253,-0.061243415,0.35575208,-0.05288122,-0.2400258,-0.5439195,0.0923892,-0.44645524,-0.1427596,-0.08500383,-0.099501714,-0.49699026,0.10080206,-0.45178154,-0.64851445,0.02950512,-0.14819296,0.9960501,0.15631984,0.018146979,0.24270457,-0.27356252,0.1675201,0.49698418,0.62268156,-0.46977258,0.4548884,0.4996486,-0.1413826,0.7840822,-0.055748478,-0.34118652,-0.6019712,0.20381087,-0.10461827,0.04069837,0.15846567,0.24779852,0.080296636,0.4050524,-0.3912248,0.14276573,0.008521851,0.04945234,0.059340857,0.19711588,0.06436741,-0.24055564,-0.37899444,-0.6127415,0.7965646,-0.03947046,0.05054213,-0.4851667,0.49389812,-0.4752504,0.27440313,-0.09833528,0.045864068,-0.23241019,0.7766482,0.41339907,0.46041238,-0.670459,0.14421241,0.15651676,0.41690323,-0.14336011,0.548129,-0.12596777,-0.009823486,0.060565047,0.23283906,-0.6451033,0.52215034,-0.36416897,0.015469128,-0.6110439,-0.6191671,-0.7192342,0.6883941,0.9003092,1.3898543,-0.39036793,0.13479526,0.08347474,0.15223992,0.25654685,-0.6639048,0.7238635,-0.19328007,0.57046175,-0.041677643,0.25419745,-0.4021807,-0.41669607,0.38129562,-0.15473773,0.042181432,0.09353247,-0.61445236,-0.611774,0.065027565,-0.5225239,-0.753482,-0.09250149,-0.25285488,0.60095954,-0.040289342,-0.29383618,-0.19587606,-0.75554013,-0.15660657,0.22342707,0.15445974,-0.10570018,-0.4107787,-0.2837987,-0.8868564,0.36014026,0.40307704,0.031466678,0.45821777,-1.2084407,-0.69550467,0.3436108,-0.18322906,-0.24958548,-0.013299829,0.18317512,0.40861815,0.43299118,-0.62844795,-0.17321193,-0.22864284,-0.6755679,0.52254647,-0.94048285,0.3700927,0.5341524,0.13880508,-0.20681548,0.11092088,-0.36019388,-0.36493802,-0.3695057,0.3299762,-0.41685775,-0.5423143,1.0154078,-0.023482114,-0.13878122,0.24167064,-0.46482602,-0.22567123,0.08261964,-0.7329022,-0.48184818,0.80077994,-0.63667643,0.5239525,0.35193032,-0.008571319,0.24096376,-0.50805116,0.29606125,-0.10201025,-0.13399239,-0.6953709,-0.5578997,0.16466331,0.35347185,0.10675294,0.073815845,-0.26199898,-0.05054146,0.010740973,0.40540934,-0.75106037,-0.7654398,-0.12834106,0.33340853,0.764174,-0.32188442,0.084699236,-0.5867575,-0.65160996,0.6893321,-0.29957289,0.3181516,-0.16350707,-0.30820507,-0.6461143,0.4989419,-0.44741738,0.39673275,-0.922664,-0.13153109,0.2664073,0.45909426,-0.16691375,-0.7749278,-0.23354371,0.529539,-0.048268728,-0.59698266,0.04682201,0.6190555,-0.23155153,-0.06554636,0.60051024,-0.63582367,-1.0499382,-0.3407878,0.13214462,-0.59388775,-0.087051556,-0.63232493,-0.846889,0.11056855,0.3403979,0.34587252,-0.21939047,-0.21208851,-0.2591661,-1.0347059,-0.48539394,0.16213454,-0.5280243,-0.9656286,-0.15181626,0.6517679,-0.03676424,-0.14785121,-0.003829956,-0.0041243285,0.6478623,0.38282007,0.20612018,-0.6126593,0.021798886,-0.44789195,-0.41018742,0.29349512,-0.4988606,0.06371528,-0.3494682,-0.34756285,-0.2736029,-0.4180078,0.20968625,-0.5111686,0.8872881,-0.15224797,0.20839868,0.1872103,0.3191055,0.17852041,-0.043872412,-0.5058206,-0.37486446,-0.055856213,-1.2088015,0.7062496,0.03362705,-0.25017995,-0.19562696,-0.23565435,0.43637094,-0.77937603,0.16119751,0.5690257,-0.01266288,0.055064186,-0.49303123,0.1749775,0.1446904,0.44824135,-0.27666998,-0.059283793,0.0028188638,0.020953704,-0.44199958,-0.1160334,-0.8948214,0.3435795,0.86867076,-0.19543841,0.44284198,-0.5420697,-0.78212905,0.08253385,0.44090885,0.012328403,-0.37062213,0.069404215,0.50661683,-0.26679152,0.037966155,0.7362274,-0.7405348,0.025941456,0.32301012,-0.15170811,-1.1132511,0.669916,0.85100955,-0.8837613,-0.37524366,-0.26506063,-0.28926668,-0.01216118,0.04750797,-0.33779475,-0.13030046,-0.28351942,-0.14113861,0.54320395,-0.04917857,0.04627373,-0.43218836,0.6412676,0.1272997,-0.004021505,0.73205155,-0.74489784,-0.056061555,-0.842049,-0.60590553,-0.035107642,0.09731718,0.79789686,-0.5727671,0.06023788,-0.3321594,-0.26195407,1.043637,-0.30585417,0.3324771,1.0960097,-0.066860184,-0.5765834,-0.33965465,0.8386639,0.25361824,0.08868775,-0.0948161,-0.13847099,0.714809,0.030872807,-0.22110614,-0.838562,-0.96878475,-0.6715857,-0.09667538,-0.13269797,-0.35955948,0.22074717,0.5225157,-0.079327986,-0.008916397,-0.21015185,0.18391635,-0.30441204,0.19526516,0.10002063,0.26072007,-0.30486453,-0.2738045,0.14352122,-0.048908822,-0.4818141,-0.00940834,-0.034290396,0.15155238,-1.1358261,0.79360145,-0.37913623,0.21860605,-0.64716905,-0.17659026,0.06072472,0.33826748,-0.55038464,0.5186275,0.5784009,-0.37820944,-0.09154895,-0.2524557,-0.41859263,-0.2584468,0.08794351,-0.1150795,0.16029912,-0.23801258,0.47532842,0.4287145,-0.35541707,-0.30823746,-0.37646228,0.2994735,-0.039189607,-0.27881432,0.12182963,0.8402794,0.32218677,0.9121472,-0.6140801,0.37489662,0.16924414,-0.44240153,-0.08436738,0.26868677,0.5298532,-0.4629818,-0.14085399,0.6677292,-0.22346236,0.15822694,0.042015217,0.13799103,0.12717576,0.4784947,-0.31224638,0.19927405,0.43470162,-0.41964528,0.3943086,-0.33239904,-0.5237076,0.06729567,-0.62281567,-0.29982597,0.26734823,-0.4141648,0.23855203,0.34821275,-0.6831771,-0.20954241,0.35953268,-0.38011956,0.7424246,-0.28792024,-0.36536098,0.90930444,-0.44226876,-0.6523378,-0.40185907,-0.11921053,-0.66888285,-0.68325686,-0.25058216,0.6825651,0.059369683,-0.35995445,-0.77012265,0.004430704,-0.3049714,-0.47091642,-0.43502557,0.343095,-0.25558877,-0.042711638,0.14656107,0.20818895,0.5296692,0.2956149,0.44043148,-0.23016883,-0.17498383,-0.5356158,-0.26092273,0.2552258,0.48240533,0.37774605,0.4123732,-0.4593912,0.25535738,0.050548866,0.7967295,0.28710765,0.4373306,0.024881791,-0.16534534,0.37449512,-0.49817348,-0.5438556,0.8352687,0.32701662,-0.113651544,0.36970195,-0.55492336,-0.09969409,0.07096957,-0.21560472,0.30183274,-0.18711057,0.34092498,0.5728583,-0.08164924,-0.14702296,-0.25701582,0.029995807,-0.29118127,0.21240985,0.12072472,-0.15539166,-0.13494852,0.5051335,0.35624564,0.19906983,-0.5898948,0.9927758,-0.5638088,0.105874464,0.24626683,0.15491298,-0.0364241,-0.00014183181,-0.24443004,-0.43542713,-0.23242386,0.271654,0.041493163,0.04075715,0.48337096,-0.03368724,-0.29967037,-0.52028024,0.52870214,-0.77548003,0.095046006,0.3285589,-0.24129698,-0.10033095,0.45148396,-0.15137771,0.80744994,0.10202535,1.3046898,0.27525118,0.546719,0.37231615,0.34481746,-0.29592073,-0.51276815,-0.50461614,-0.041179955,0.3722261,0.1100366,0.42853138,-0.58571494,-0.35207477,-0.6323793,-0.06508177,-0.62862587,-0.6697737,0.618133,0.6044329,-0.05509063,-0.27620336,0.6852253,0.20330097,1.0823795,0.7268067,-0.40970054,-0.34884927,0.16780886,-0.7926562,1.458208,0.1828444,-0.65604717,0.33519745,-1.0766068,-0.48040348,0.057537276,-0.2789366,-0.5902056,-0.14646149,0.38515258,0.8559201,0.22752208,-0.1213465,0.1287005,0.5950867,0.49763557,0.19174819,0.6096212,0.5119306,-0.04031235,0.17517035,-0.1729675,0.24371767,-0.2925097,0.18191202,-0.099758945,-0.21196091,-0.087351374,-0.0125186015,0.18986666,-0.08207916,-0.029999927,-0.060497843,-1.085049,-0.116337314,-0.57811713,0.027158752,0.76528394,0.16233239,-0.11688605,0.43828914,0.26569548,-0.7194396,4.7115912,0.84023577,0.01350715,0.4945645,0.35506433,0.33160073,1.3092053,-0.46369475,0.056426294,-0.06825559,-0.030192386,-0.06390701,0.31081718,-0.18419924,0.36915258,0.4647702,-0.47152096,0.22578484,-0.01072973,-0.61152685,-0.6715144,0.04423112,-0.004726,0.5619209,0.41729575,-0.11368859,0.50632167,-0.3464636,0.21002957,-0.13728164,-0.042565785,-0.25835216,0.14267278,-0.26475236,-0.38810351,-0.35113508,0.41523185,-0.8433446,-0.4126364,0.3680641,0.10004118,-0.12505217,0.35454738,0.14676484,0.2467018,0.7952758,-0.36866623,0.055383526,0.5656794,-0.89834404,0.7227873,-0.2759683,0.9467481,0.5835295,-0.71221685,-0.035608195,0.059426002,-0.55145717,0.18009405,0.04703971,0.6267802,-0.19953111,-0.11499183,-0.38844106,-0.30883738,0.30621624,-0.15623303,0.022938184,0.0012993142,0.5471631,-0.09215132,-0.8533485,-0.530178,-0.34687558,0.7454186,-0.773585,-0.22387142,0.09336754,-0.20096765,-0.57537496,-0.15397498,-0.6866344,-1.116356,0.3335687,0.53614205,0.7552288,0.011036962,-0.5450965,-0.13446324,-0.05810429,-0.020157844,0.13527225,-0.21853155,0.26557618,0.5953165]",
}
